% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/multicopy.R
\name{collapse_orthologs}
\alias{collapse_orthologs}
\title{Collapse multi-copy orthologs to expand CCS reference set}
\usage{
collapse_orthologs(
  orthologs,
  similarity_sp1,
  similarity_sp2,
  multicopy_sp = c("sp2", "sp1", "both"),
  max_copy_number = 2L
)
}
\arguments{
\item{orthologs}{Data frame with columns \code{gene_sp1}, \code{gene_sp2}, and
optionally \code{type} (from \code{detect_ortholog_types()}).}

\item{similarity_sp1}{Similarity matrix for species 1. Can be a regular
matrix or a TriSimilarity object.}

\item{similarity_sp2}{Similarity matrix for species 2. Can be a regular
matrix or a TriSimilarity object.}

\item{multicopy_sp}{Character. Which species has the multi-copy issue:
\itemize{
\item \code{"sp2"} (default): Collapses N:1 groups (sp2 has duplicates, e.g.
diploid-to-polyploid comparison).
\item \code{"sp1"}: Collapses 1:N groups (sp1 has duplicates).
\item \code{"both"}: Collapses both sides sequentially (e.g. two de novo
transcriptomes). Handles N:M groups via greedy two-pass selection.
}}

\item{max_copy_number}{Integer or NULL. Only collapse groups with at most
this many copies (default 2L, matching WGD). Set to NULL to collapse all
group sizes.}
}
\value{
Data frame with columns:
\describe{
\item{gene_sp1, gene_sp2}{The selected ortholog pair.}
\item{type}{Set to \code{"1:1"} for all rows, so collapsed pairs integrate
seamlessly with \code{\link[=calculate_ccs]{calculate_ccs()}} \code{use_only_1to1 = TRUE}.}
\item{original_type}{Pre-collapse type: \code{NA} for natural 1:1 orthologs;
\code{"N:1"}, \code{"1:N"}, or \code{"N:M"} for collapsed pairs.}
\item{homeolog_score}{Preliminary CCS score used for selection (\code{NA} for
natural 1:1 pairs).}
\item{n_candidates}{Number of candidates in the group (1 for natural
1:1 pairs).}
}
}
\description{
For each multi-copy ortholog group, runs a preliminary CCS-like scoring pass
using the existing 1:1 reference set, then selects the best representative
from each group. This expands the reference set while maintaining a proper
bijective (1:1) mapping.
}
\details{
This is useful when very few genes have clean 1:1 ortholog relationships,
as occurs with polyploids (WGD-derived homeologs) or de novo transcriptome
assemblies (fragmented isoforms).

The scoring function for each candidate pair correlates their co-expression
vectors (restricted to the 1:1 reference genes) across the two species â€” the
same logic as CCS, but using only the initial 1:1 set as reference.

\strong{Type convention} (from \code{detect_ortholog_types()}):
\itemize{
\item \code{"N:1"}: \code{gene_sp1} appears multiple times (sp1 gene has N sp2 partners).
Multi-copy is on sp2 side. Group by \code{gene_sp1} to pick best \code{gene_sp2}.
\item \code{"1:N"}: \code{gene_sp2} appears multiple times (sp2 gene has N sp1 partners).
Multi-copy is on sp1 side. Group by \code{gene_sp2} to pick best \code{gene_sp1}.
\item \code{"N:M"}: Both sides have duplicates.
}
}
\examples{
\dontrun{
# Collapse N:1 homeologs (diploid vs polyploid)
expanded_ref <- collapse_orthologs(
  orthologs, sim_sp1, sim_sp2,
  multicopy_sp = "sp2", max_copy_number = 2L
)

# Use expanded reference for CCS
ccs <- calculate_ccs(sim_sp1, sim_sp2, expanded_ref)
}

}
